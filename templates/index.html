<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Compare App</title>
    <link rel="stylesheet" href="/static/css/index.css">
    <style>
        .hidden { display: none; }
        .image-preview { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; }
        .upload-area { border: 2px dashed #ccc; padding: 16px; text-align: center; cursor: pointer; border-radius: 8px; }
        .upload-area.dragover { border-color: #339fad; background: #f0fbfd; }
        .actions { margin-top: 10px; }
        .video-wrap { position: relative; width: 100%; max-width: 640px; }
        #video { display:none; }
        #landmarksCanvas { position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; border:1px solid #ccc; border-radius:4px; }
    </style>
    </head>
<body>
    <h1 class="content_title">〜 以前の自分と比較しよう 〜</h1>
    <div class="content">
        <div id="successMessage" class="message success" style="display:none;"></div>
        <div id="errorMessage" class="message error" style="display:none;"></div>

        <div class="instructions">
            <h3>使い方</h3>
            <ol>
                <li>基準画像をアップロード（またはカメラで撮影）</li>
                <li>比較したい画像をアップロード（または撮影）</li>
                <li>「比較する」を押して結果を表示</li>
            </ol>
        </div>

        <!-- 基準画像アップロード -->
        <section>
            <h3>基準画像</h3>
            <div id="baseUploadArea" class="upload-area">ここにドラッグ＆ドロップ、またはクリックして選択</div>
            <input type="file" id="baseImageInput" accept="image/*" style="display:none;" />
            <div class="actions">
                <button id="setBaseBtn" style="display:none;">基準画像に設定</button>
            </div>
            <div id="baseImagePreview"></div>
        </section>

        <!-- 比較画像アップロード -->
        <section>
            <h3>比較画像</h3>
            <div id="compareUploadArea" class="upload-area">ここにドラッグ＆ドロップ、またはクリックして選択</div>
            <input type="file" id="compareImageInput" accept="image/*" style="display:none;" />
            <div class="actions">
                <button id="compareBtn" style="display:none;">比較する</button>
            </div>
            <div id="compareImagePreview"></div>
        </section>

        <!-- ブラウザカメラ -->
        <section>
            <h3>ブラウザカメラ</h3>
            <div class="video-wrap">
                <video id="video" autoplay playsinline style="width:100%; max-width:640px; border:1px solid #ccc; border-radius:4px;"></video>
                <canvas id="landmarksCanvas"></canvas>
            </div>
            <canvas id="canvas" class="hidden"></canvas>
            <div class="actions">
                <button id="startCameraBtn">カメラを起動</button>
                <button id="captureBtn" style="display:none;">撮影して比較画像に使用</button>
                <button id="stopCameraBtn" style="display:none;">カメラ停止</button>
            </div>
        </section>

        <!-- 結果エリア -->
        <div id="loading" class="loading" style="display:none;">処理中...</div>
        <div id="results" class="results hidden">
            <h3>分析結果</h3>
            <div id="analysisGrid" class="analysis-grid"></div>
            <div id="descriptions" class="descriptions"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>